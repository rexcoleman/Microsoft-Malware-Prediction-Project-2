# src/data/clean_data.py

import pandas as pd
import yaml
from src.config_loader import load_paths

def impute_missing_values(df, strategies):
    default_value = 'Unknown'  # You can customize this default value as needed
    
    for feature, strategy in strategies['numerical_features'].items():
        if strategy == 'mean':
            df[feature].fillna(df[feature].mean(), inplace=True)
        elif strategy == 'median':
            df[feature].fillna(df[feature].median(), inplace=True)
        elif strategy == 'mode':
            mode_value = df[feature].mode()
            if not mode_value.empty:
                df[feature].fillna(mode_value[0], inplace=True)
            else:
                print(f"Warning: No mode found for feature {feature}. Imputation skipped.")

    for feature, strategy in strategies['categorical_features'].items():
        if strategy == 'mode':
            mode_value = df[feature].mode()
            if not mode_value.empty:
                df[feature].fillna(mode_value[0], inplace=True)
            else:
                print(f"Warning: No mode found for feature {feature}. Imputing with default value '{default_value}'.")
                df[feature].fillna(default_value, inplace=True)
        else:
            df[feature].fillna(strategy, inplace=True)

    for feature, strategy in strategies['binary_features'].items():
        if strategy == 'mode':
            mode_value = df[feature].mode()
            if not mode_value.empty:
                df[feature].fillna(mode_value[0], inplace=True)
            else:
                print(f"Warning: No mode found for feature {feature}. Imputation skipped.")

    return df

def clean_data(train_df, test_df):
    paths = load_paths()
    with open(paths['config']['imputation_strategies'], 'r') as file:
        strategies = yaml.safe_load(file)

    train_cleaned = impute_missing_values(train_df.copy(), strategies)
    test_cleaned = impute_missing_values(test_df.copy(), strategies)
    
    return train_cleaned, test_cleaned

