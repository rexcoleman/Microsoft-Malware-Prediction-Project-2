# src/data/clean_data.py

import pandas as pd
from tqdm import tqdm
import yaml

def load_imputation_strategies(config_path):
    """
    Load imputation strategies from a YAML configuration file.
    
    Parameters:
    - config_path (str): The path to the YAML config file containing imputation strategies.
    
    Returns:
    - dict: Imputation strategies.
    """
    with open(config_path, 'r') as file:
        imputation_strategies = yaml.safe_load(file)
    return imputation_strategies

def initial_imputation(df, imputation_strategies):
    """
    Perform initial imputation on a dataframe using specified strategies.
    
    Parameters:
    - df (DataFrame): The dataframe to impute.
    - imputation_strategies (dict): The imputation strategies for each column.
    
    Returns:
    - DataFrame: The imputed dataframe.
    """
    for column, strategy in tqdm(imputation_strategies.items(), desc="Imputing missing values"):
        if strategy == 'mean':
            df[column].fillna(df[column].mean(), inplace=True)
        elif strategy == 'median':
            df[column].fillna(df[column].median(), inplace=True)
        elif strategy == 'mode':
            df[column].fillna(df[column].mode()[0], inplace=True)
    return df

def save_imputation_strategies(imputation_strategies, config_path):
    """
    Save imputation strategies to a YAML configuration file.
    
    Parameters:
    - imputation_strategies (dict): The imputation strategies for each column.
    - config_path (str): The path to the YAML config file where strategies will be saved.
    """
    with open(config_path, 'w') as file:
        yaml.safe_dump(imputation_strategies, file)

# Example usage
if __name__ == "__main__":
    # Load data
    data_path = "../data/raw/train.csv"
    df = pd.read_csv(data_path, nrows=10000)
    
    # Load imputation strategies
    config_path = "../config/imputation_strategies.yaml"
    imputation_strategies = load_imputation_strategies(config_path)
    
    # Perform initial imputation
    df_imputed = initial_imputation(df, imputation_strategies)
    
    # Save the updated imputation strategies (if any)
    save_imputation_strategies(imputation_strategies, config_path)
